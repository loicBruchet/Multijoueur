#include "pch.h"

void StatePlayerGlobal::OnEnter(Player& cur, int from)
{
}

void StatePlayerGlobal::OnExecute(Player& cur)
{

	cur.Update();
}

void StatePlayerGlobal::OnExit(Player& cur, int to)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


void StatePlayerIdle::OnEnter(Player& cur, int from)
{
	cur.SetState(1);
}

void StatePlayerIdle::OnExecute(Player& cur)
{

}

void StatePlayerIdle::OnExit(Player& cur, int to)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void StatePlayerSpawn::OnEnter(Player& cur, int from)
{
	cur.GetEntity()->dead = false;
	cur.SetHealth(50);
	cur.SetState(2);

	int choice = rand() % cur.m_pSpawnPosition.size();
	cur.GetEntity()->transform.pos = cur.m_pSpawnPosition[choice- 1];
	//cpuEngine.GetCamera()->transform.pos = cur.GetEntity()->transform.pos;
	//cpuEngine.GetCamera()->transform.pos.y += 2;
	
	cur.GetEntity()->transform.ResetRotation();
}

void StatePlayerSpawn::OnExecute(Player& cur)
{
	float dt = cpuTime.delta;

	cpu_entity* pEntity = cur.GetEntity();
	cur.GetEntity()->transform.pos.z += dt * 1.0f;
	//cpuEngine.GetCamera()->transform.LookAt(pEntity->transform.pos.x, pEntity->transform.pos.y, pEntity->transform.pos.z);
	if (cur.GetFSM()->totalTime > 5.0f)
	{
		cur.GetFSM()->ToState(CPU_ID(StatePlayerIdle));
		return;
	}
}

void StatePlayerSpawn::OnExit(Player& cur, int to)
{

}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void StatePlayerBlink::OnEnter(Player& cur, int from)
{
	cur.SetState(3);
}

void StatePlayerBlink::OnExecute(Player& cur)
{
	float v = fmod(cur.GetFSM()->totalTime, 0.2f);
	if (v < 0.1f)
	{
		cur.GetEntity()->visible = true;
	}
	else
	{
		cur.GetEntity()->visible = false;
	}

	if (cur.GetFSM()->totalTime > 1.0f)
	{
		cur.GetFSM()->ToState(CPU_ID(StatePlayerIdle));
		return;
	}
}

void StatePlayerBlink::OnExit(Player& cur, int to)
{
}
